<!DOCTYPE html>
<html lang="ar"> <!-- تغيير اللغة إلى العربية -->
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CesiumJS - Open Source Maps</title>
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.104/Build/Cesium/Cesium.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.104/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Tajawal', sans-serif; /* تحسين الخط */
    }
    #cesiumContainer {
      width: 100%;
      height: 100vh;
  background: linear-gradient(to right, #ff7e5f, #feb47b); 
  filter: brightness(1.1); 
    }
    .cesium-viewer-toolbar,
    .cesium-viewer-animationContainer,
    .cesium-viewer-timelineContainer,
    .cesium-viewer .cesium-credit-logoContainer,
    .cesium-viewer .cesium-credit-textContainer {
      display: none !important;
    }
  </style>
</head>
<body>
  <div id="cesiumContainer"></div>

  <script>
    // إنشاء خريطة Cesium
    const viewer = new Cesium.Viewer('cesiumContainer', {
  imageryProvider: new Cesium.UrlTemplateImageryProvider({
    url: 'https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
    credit: '© Esri'
  }),
  baseLayerPicker: false,
  infoBox: false,
  selectionIndicator: false
});

    // تحديد الكاميرا
    viewer.camera.setView({
      destination: Cesium.Cartesian3.fromDegrees(9.608857, 36.651069, 200),
      orientation: {
        heading: Cesium.Math.toRadians(130),
        pitch: Cesium.Math.toRadians(-25),
        roll: 0
      }
    });
    // تحسين العرض
    viewer.shadows = true;
    viewer.scene.shadowMap.maximumDistance = 1000;
    viewer.scene.shadowMap.size = 2048;
    viewer.resolutionScale = 2.0;
    viewer.scene.globe.tileCacheSize = 1000;
    viewer.scene.globe.baseColor = Cesium.Color.LIGHTGRAY;
viewer.scene.globe.baseColor = Cesium.Color.fromCssColorString('#e0e0e0'); // تغيير اللون الأساسي للأرض

    viewer.scene.light = new Cesium.DirectionalLight({
      direction: new Cesium.Cartesian3(1, 1, -1),
      intensity: 5.0
    });

    viewer.scene.ambientLight = new Cesium.Color(1.0, 1.0, 1.0, 0.5);

    // دالة لإنشاء الأيقونة
    function createIconImage(iconUrl) {
      return new Promise((resolve) => {
        const icon = new Image();

        icon.onload = function () {
          const canvas = document.createElement("canvas");
          const ctx = canvas.getContext("2d");
          const iconSize = 40;

          canvas.width = iconSize;
          canvas.height = iconSize;

          ctx.drawImage(icon, 0, 0, iconSize, iconSize);

          resolve(canvas.toDataURL());
        };

        icon.src = iconUrl;
      });
    }

    // دالة لإنشاء النص
    function createTextImage(text, font = "5px Tajawal", textColor = "#000") {
      return new Promise((resolve) => {
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");

        ctx.font = font;
        const textWidth = ctx.measureText(text).width;

        canvas.width = textWidth + 20;
        canvas.height = 20;

        ctx.fillStyle = textColor;
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(text, canvas.width / 2, canvas.height / 2);

        resolve(canvas.toDataURL());
      });
    }

    // قائمة الأماكن
    const places = [
      {
        name: "Shell",
        latitude: 36.649848,
        longitude: 9.609992,
        iconUrl: "/icon/mollusque.png",
        link: "http://localhost:7700/Pwaap-main/index%202.html"
      },
      {
        name: "جامع المنوبي",
        latitude: 36.649706,
        longitude: 9.611688,
        iconUrl: "/icon/mosquee.png",
        link: "http://localhost:7700/Pwaap-main/index%202.html"
      }
    ];

    // خريطة لتتبع الكيانات
    const entityMap = new Map();

    // إضافة الأماكن إلى الخريطة
    places.forEach((place) => {
      Promise.all([
        createIconImage(place.iconUrl),
        createTextImage(place.name)
      ]).then(([iconImage, textImage]) => {
        // إضافة الأيقونة
        const iconEntity = viewer.entities.add({
          position: Cesium.Cartesian3.fromDegrees(place.longitude, place.latitude),
          billboard: {
            image: iconImage,
            width: 32,
            height: 32,
            verticalOrigin: Cesium.VerticalOrigin.BOTTOM
          }
        });

        // إضافة النص أسفل الأيقونة
        const textEntity = viewer.entities.add({
          position: Cesium.Cartesian3.fromDegrees(place.longitude, place.latitude),
          billboard: {
            image: textImage,
            width: 80,
            height: 20,
            verticalOrigin: Cesium.VerticalOrigin.TOP,
            pixelOffset: new Cesium.Cartesian2(0, 8) // إزاحة النص أسفل الأيقونة
          }
        });

        // إضافة الرابط إلى الأيقونة فقط
        entityMap.set(iconEntity, place.link);
      });
    });

    // إضافة معالج النقر على الأيقونات
    const handler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);
    handler.setInputAction(function(click) {
      const pickedObject = viewer.scene.pick(click.position);
      if (Cesium.defined(pickedObject) && entityMap.has(pickedObject.id)) {
        let link = entityMap.get(pickedObject.id);

        if (!link.startsWith("http://") && !link.startsWith("https://")) {
          link = "https://" + link;
        }

        window.location.href = link;
      }
    }, Cesium.ScreenSpaceEventType.LEFT_CLICK);
  </script>
</body>
</html>
